<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-DPI Canvas & Utilities - CSCI 3213</title>
    
    <!-- OCU Branded Presentation Styles with Theme Support -->
    <link rel="stylesheet" href="../../styles/presentation.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    
    <!-- Lecture-Specific Styles -->
    <style>
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .canvas-demo {
            border: 2px solid var(--border-color, #333);
            background: white;
            margin: 10px auto;
            display: block;
        }
        
        .utility-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .utility-card {
            background: var(--card-bg, #f8f8f8);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--ocu-cyan);
        }
        
        .exercise-timer {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--ocu-gold);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2em;
            display: none;
            z-index: 100;
        }
        
        .pixel-ratio-display {
            font-size: 2em;
            color: var(--ocu-cyan);
            margin: 20px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Theme toggle will be automatically added by JavaScript -->
    
    <div class="presentation-container">
        <!-- Timer display for activities -->
        <div class="timer-display" id="timer-display">
            <span id="timer-text">High-DPI Canvas & Utilities
                 <button class="home"><a href="../index.html">Home</a></button>
            </span>
        </div>

        <div class="exercise-timer" id="exercise-timer">
            <span id="exercise-time">10:00</span> remaining
        </div>

        <!-- Slide 1: Title -->
        <div class="slide active">
            <h1>High-DPI Canvas & Utilities</h1>
            <h2>Building Crystal-Clear Graphics <span class="emoji">üîç</span></h2>
            <p style="font-size: 1.5em; margin-top: 40px;">CSCI 3213 - Game Programming</p>
            <p style="font-size: 1.3em;">Session 2</p>
            <p style="margin-top: auto; font-style: italic;">Making games look sharp on any screen!</p>
        </div>

        <!-- Slide 2: Learning Objectives -->
        <div class="slide">
            <h1>Today's Quest Objectives</h1>
            <ul style="font-size: 1.4em; line-height: 2;">
                <li>üéØ Understand pixel density and retina display challenges</li>
                <li>üéØ Implement device pixel ratio calculations</li>
                <li>üéØ Create reusable utility modules</li>
                <li>üéØ Apply canvas transformations for proper scaling</li>
            </ul>
            <div class="tip-box">
                <strong>Key Skill:</strong> Creating graphics that look perfect on all devices!
            </div>
        </div>

        <!-- Slide 3: The Pixel Density Problem -->
        <div class="slide">
            <h1>The Retina Display Challenge</h1>
            <p style="font-size: 1.3em;">Why does canvas look blurry on some screens?</p>
            
            <div class="comparison-grid">
                <div class="comparison-item">
                    <h3>Standard Display</h3>
                    <p>1 CSS pixel = 1 device pixel</p>
                    <canvas class="canvas-demo" width="100" height="100" style="width: 100px; height: 100px;"></canvas>
                    <p>Looks fine! ‚úÖ</p>
                </div>
                <div class="comparison-item">
                    <h3>Retina Display</h3>
                    <p>1 CSS pixel = 2+ device pixels</p>
                    <canvas class="canvas-demo" width="100" height="100" style="width: 100px; height: 100px;"></canvas>
                    <p>Blurry without scaling! ‚ùå</p>
                </div>
            </div>
            
            <div class="demo-box">
                <p><strong>Your Device Pixel Ratio:</strong></p>
                <p class="pixel-ratio-display" id="pixelRatio">Loading...</p>
            </div>
        </div>

        <!-- Slide 4: Understanding Device Pixel Ratio -->
        <div class="slide">
            <h1>Device Pixel Ratio Explained</h1>
            
            <div class="code-example">
                <span class="comment">// Get the device's pixel ratio</span>
                <span class="keyword">var</span> <span class="variable">dpr</span> = window.devicePixelRatio || <span class="number">1</span>;
                
                <span class="comment">// What this means:</span>
                <span class="comment">// dpr = 1: Standard display</span>
                <span class="comment">// dpr = 2: Retina display (4x pixels)</span>
                <span class="comment">// dpr = 3: Super Retina (9x pixels)</span>
            </div>
            
            <p style="font-size: 1.2em; margin-top: 20px;">Common Device Pixel Ratios:</p>
            <ul>
                <li>Most desktop monitors: <strong>1.0</strong></li>
                <li>MacBook Pro Retina: <strong>2.0</strong></li>
                <li>iPhone 12/13/14: <strong>3.0</strong></li>
                <li>Some Android phones: <strong>2.0 - 4.0</strong></li>
            </ul>
        </div>

        <!-- Slide 5: The Solution - High-DPI Canvas -->
        <div class="slide">
            <h1>Creating High-DPI Canvas</h1>
            <p>The secret: Make the canvas bigger, then scale it down!</p>
            
            <div class="code-example">
                <span class="keyword">function</span> <span class="function">createHiDPICanvas</span>(<span class="parameter">width</span>, <span class="parameter">height</span>) {
                    <span class="keyword">var</span> <span class="variable">canvas</span> = document.createElement(<span class="string">'canvas'</span>);
                    <span class="keyword">var</span> <span class="variable">ctx</span> = canvas.getContext(<span class="string">'2d'</span>);
                    <span class="keyword">var</span> <span class="variable">dpr</span> = window.devicePixelRatio || <span class="number">1</span>;
                    
                    <span class="comment">// Set actual size in memory (scaled up)</span>
                    canvas.width = width * dpr;
                    canvas.height = height * dpr;
                    
                    <span class="comment">// Set display size (CSS pixels)</span>
                    canvas.style.width = width + <span class="string">'px'</span>;
                    canvas.style.height = height + <span class="string">'px'</span>;
                    
                    <span class="comment">// Scale the drawing context to match device ratio</span>
                    ctx.scale(dpr, dpr);
                    
                    <span class="keyword">return</span> canvas;
                }
            </div>
        </div>

        <!-- Slide 6: Module Pattern Introduction -->
        <div class="slide">
            <h1>JavaScript Module Pattern</h1>
            <p>Organizing our code into reusable utilities!</p>
            
            <div class="code-example">
                <span class="comment">// utils/canvas.js</span>
                <span class="keyword">var</span> <span class="variable">canvasUtils</span> = {
                    <span class="function">generateCanvas</span>: <span class="keyword">function</span>(<span class="parameter">w</span>, <span class="parameter">h</span>) {
                        <span class="comment">// Canvas creation logic here</span>
                        <span class="keyword">return</span> canvas;
                    },
                    
                    <span class="function">getPixelRatio</span>: <span class="keyword">function</span>() {
                        <span class="keyword">var</span> <span class="variable">ctx</span> = document.createElement(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);
                        <span class="keyword">var</span> <span class="variable">dpr</span> = window.devicePixelRatio || <span class="number">1</span>;
                        <span class="keyword">return</span> dpr;
                    }
                };

                <span class="comment">// Export for use in other files</span>
                module.exports = canvasUtils;
            </div>
            
            <div class="tip-box">
                <strong>Why Modules?</strong> Keep code organized, reusable, and testable!
            </div>
        </div>

        <!-- Slide 7: Complete Utility Module -->
        <div class="slide">
            <h1>Building Our Canvas Utility</h1>
            
            <div class="code-example" style="font-size: 0.9em;">
                <span class="comment">// /js/utils/utils.canvas.js</span>
                module.exports = {
                    <span class="function">getPixelRatio</span>: <span class="keyword">function</span>(<span class="parameter">context</span>) {
                        <span class="keyword">var</span> <span class="variable">backingStore</span> = context.backingStorePixelRatio ||
                            context.webkitBackingStorePixelRatio ||
                            context.mozBackingStorePixelRatio ||
                            context.msBackingStorePixelRatio ||
                            context.oBackingStorePixelRatio || <span class="number">1</span>;
                        
                        <span class="keyword">return</span> (window.devicePixelRatio || <span class="number">1</span>) / backingStore;
                    },
                    
                    <span class="function">generateCanvas</span>: <span class="keyword">function</span>(<span class="parameter">w</span>, <span class="parameter">h</span>) {
                        <span class="keyword">var</span> <span class="variable">canvas</span> = document.createElement(<span class="string">'canvas'</span>);
                        <span class="keyword">var</span> <span class="variable">ctx</span> = canvas.getContext(<span class="string">'2d'</span>);
                        <span class="keyword">var</span> <span class="variable">ratio</span> = <span class="keyword">this</span>.getPixelRatio(ctx);
                        
                        canvas.width = Math.round(w * ratio);
                        canvas.height = Math.round(h * ratio);
                        canvas.style.width = w + <span class="string">'px'</span>;
                        canvas.style.height = h + <span class="string">'px'</span>;
                        ctx.setTransform(ratio, <span class="number">0</span>, <span class="number">0</span>, ratio, <span class="number">0</span>, <span class="number">0</span>);
                        
                        <span class="keyword">return</span> canvas;
                    }
                };
            </div>
        </div>

        <!-- Slide 8: More Utility Functions -->
        <div class="slide">
            <h1>Essential Game Utilities</h1>
            
            <div class="utility-showcase">
                <div class="utility-card">
                    <h3>üé® Random Color</h3>
                    <div class="code-example" style="font-size: 0.8em;">
                        <span class="function">randomColor</span>: <span class="keyword">function</span>() {
                            <span class="keyword">return</span> <span class="string">'#'</span> + 
                                Math.random().toString(<span class="number">16</span>)
                                .substr(-<span class="number">6</span>);
                        }
                    </div>
                </div>
                
                <div class="utility-card">
                    <h3>üìç Random Position</h3>
                    <div class="code-example" style="font-size: 0.8em;">
                        <span class="function">randomPos</span>: <span class="keyword">function</span>(<span class="parameter">max</span>) {
                            <span class="keyword">return</span> Math.floor(
                                Math.random() * max
                            );
                        }
                    </div>
                </div>
                
                <div class="utility-card">
                    <h3>üîµ Draw Circle</h3>
                    <div class="code-example" style="font-size: 0.8em;">
                        <span class="function">drawCircle</span>: <span class="keyword">function</span>(<span class="parameter">ctx</span>, <span class="parameter">x</span>, <span class="parameter">y</span>, <span class="parameter">r</span>) {
                            ctx.beginPath();
                            ctx.arc(x, y, r, <span class="number">0</span>, Math.PI * <span class="number">2</span>);
                            ctx.fill();
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 9: Using Require with Browserify -->
        <div class="slide">
            <h1>Module Loading with Browserify</h1>
            
            <div class="code-example">
                <span class="comment">// In your main game.js file</span>
                <span class="keyword">var</span> <span class="variable">canvasUtils</span> = require(<span class="string">'./utils/utils.canvas.js'</span>);
                <span class="keyword">var</span> <span class="variable">gameUtils</span> = require(<span class="string">'./utils/utils.game.js'</span>);

                <span class="keyword">function</span> <span class="function">Game</span>(<span class="parameter">width</span>, <span class="parameter">height</span>) {
                    <span class="comment">// Use the utility to create high-DPI canvas</span>
                    <span class="keyword">this</span>.viewport = canvasUtils.generateCanvas(width, height);
                    <span class="keyword">this</span>.context = <span class="keyword">this</span>.viewport.getContext(<span class="string">'2d'</span>);
                    
                    <span class="comment">// Add to page</span>
                    document.body.appendChild(<span class="keyword">this</span>.viewport);
                }

                <span class="comment">// Create the game</span>
                <span class="keyword">var</span> <span class="variable">game</span> = <span class="keyword">new</span> Game(<span class="number">800</span>, <span class="number">600</span>);
            </div>
            
            <div class="demo-box">
                <p><strong>Build Command:</strong> <code>browserify js/game.js -o js/bundle.js</code></p>
            </div>
        </div>

        <!-- Slide 10: Exercise 1 - Blur Detective -->
        <div class="slide">
            <h1>Exercise 1: Blur Detective <span class="emoji">üîç</span></h1>
            <h2>Time: 10 minutes</h2>
            
            <div class="activity-box">
                <p><strong>Your Mission:</strong> Create two canvases side by side</p>
                <ol>
                    <li>Create a regular canvas (no scaling)</li>
                    <li>Create a high-DPI canvas (with proper scaling)</li>
                    <li>Draw the same content on both:
                        <ul>
                            <li>Some text (try "GAME OVER")</li>
                            <li>A circle</li>
                            <li>A thin line (1px width)</li>
                        </ul>
                    </li>
                    <li>Compare the visual quality!</li>
                </ol>
                
                <div class="tip-box">
                    <strong>Hint:</strong> The difference is most visible on retina displays!
                </div>
            </div>
        </div>

        <!-- Slide 11: Exercise 2 - Utility Builder -->
        <div class="slide">
            <h1>Exercise 2: Utility Builder <span class="emoji">üõ†Ô∏è</span></h1>
            <h2>Time: 15 minutes</h2>
            
            <div class="activity-box">
                <p><strong>Your Mission:</strong> Create a utility module with 3 helper functions</p>
                
                <div class="code-example" style="font-size: 0.9em;">
                    <span class="comment">// Create utils/gameHelpers.js with:</span>
                    module.exports = {
                        <span class="comment">// 1. Random color generator</span>
                        randomColor: <span class="keyword">function</span>() {
                            <span class="comment">// Your code here</span>
                        },
                        
                        <span class="comment">// 2. Random position within bounds</span>
                        randomPosition: <span class="keyword">function</span>(<span class="parameter">maxX</span>, <span class="parameter">maxY</span>) {
                            <span class="comment">// Your code here</span>
                        },
                        
                        <span class="comment">// 3. Draw a circle at position</span>
                        drawCircle: <span class="keyword">function</span>(<span class="parameter">ctx</span>, <span class="parameter">x</span>, <span class="parameter">y</span>, <span class="parameter">radius</span>, <span class="parameter">color</span>) {
                            <span class="comment">// Your code here</span>
                        }
                    };
                </div>
                
                <p><strong>Bonus:</strong> Use all three functions together to draw 10 random colored circles!</p>
            </div>
        </div>

        <!-- Slide 12: Exercise 3 - Scale Tester -->
        <div class="slide">
            <h1>Exercise 3: Scale Tester <span class="emoji">üîß</span></h1>
            <h2>Time: 15 minutes</h2>
            
            <div class="activity-box">
                <p><strong>Your Mission:</strong> Dynamic canvas that maintains quality on resize</p>
                
                <ol>
                    <li>Create a canvas that fills 80% of the window width</li>
                    <li>Implement a resize handler that:
                        <ul>
                            <li>Recalculates canvas dimensions</li>
                            <li>Maintains proper pixel ratio</li>
                            <li>Redraws content after resize</li>
                        </ul>
                    </li>
                    <li>Draw a grid pattern to test scaling quality</li>
                    <li>Add text showing current dimensions</li>
                </ol>
                
                <div class="code-example" style="font-size: 0.9em;">
                    window.addEventListener(<span class="string">'resize'</span>, <span class="keyword">function</span>() {
                        <span class="comment">// Recalculate and redraw</span>
                    });
                </div>
            </div>
        </div>

        <!-- Slide 13: Common Pitfalls -->
        <div class="slide">
            <h1>Common Pitfalls & Solutions</h1>
            
            <div class="demo-box" style="background: #ffeeee; border-color: #ff6666;">
                <h3>‚ö†Ô∏è Pitfall 1: Forgetting to scale the context</h3>
                <p><strong>Problem:</strong> Canvas is high-res but drawings are tiny!</p>
                <p><strong>Solution:</strong> Always use <code>ctx.scale(dpr, dpr)</code> or <code>setTransform</code></p>
            </div>
            
            <div class="demo-box" style="background: #ffeeee; border-color: #ff6666;">
                <h3>‚ö†Ô∏è Pitfall 2: Mixing CSS and canvas dimensions</h3>
                <p><strong>Problem:</strong> Canvas stretches or squashes content</p>
                <p><strong>Solution:</strong> Set both <code>canvas.width</code> and <code>canvas.style.width</code></p>
            </div>
            
            <div class="demo-box" style="background: #ffeeee; border-color: #ff6666;">
                <h3>‚ö†Ô∏è Pitfall 3: Not handling different pixel ratios</h3>
                <p><strong>Problem:</strong> Works on your screen, blurry on others</p>
                <p><strong>Solution:</strong> Always check <code>window.devicePixelRatio</code></p>
            </div>
        </div>

        <!-- Slide 14: Real-World Application -->
        <div class="slide">
            <h1>Putting It All Together</h1>
            
            <div class="code-example" style="font-size: 0.85em;">
                <span class="comment">// Complete high-DPI game setup</span>
                <span class="keyword">var</span> <span class="variable">utils</span> = require(<span class="string">'./utils/canvas.js'</span>);

                <span class="keyword">function</span> <span class="function">Game</span>() {
                    <span class="comment">// Create high-DPI canvas</span>
                    <span class="keyword">this</span>.canvas = utils.generateCanvas(<span class="number">800</span>, <span class="number">600</span>);
                    <span class="keyword">this</span>.ctx = <span class="keyword">this</span>.canvas.getContext(<span class="string">'2d'</span>);
                    
                    <span class="comment">// Set up the viewport</span>
                    <span class="keyword">this</span>.canvas.id = <span class="string">'gameCanvas'</span>;
                    document.body.appendChild(<span class="keyword">this</span>.canvas);
                    
                    <span class="comment">// Test our sharp graphics!</span>
                    <span class="keyword">this</span>.ctx.font = <span class="string">'32px Arial'</span>;
                    <span class="keyword">this</span>.ctx.fillText(<span class="string">'Crystal Clear!'</span>, <span class="number">50</span>, <span class="number">50</span>);
                }

                <span class="comment">// Start the game</span>
                window.game = <span class="keyword">new</span> Game();
            </div>
            
            <p style="margin-top: 30px; font-size: 1.2em;">üéâ Your canvas now looks perfect on any screen!</p>
        </div>

        <!-- Slide 15: Summary -->
        <div class="slide">
            <h1>Session Complete! <span class="emoji">üèÜ</span></h1>
            <h2>Skills Unlocked:</h2>
            <ul>
                <li>‚úÖ Understand pixel density challenges</li>
                <li>‚úÖ Implement device pixel ratio calculations</li>
                <li>‚úÖ Create reusable utility modules</li>
                <li>‚úÖ Build high-DPI canvases</li>
                <li>‚úÖ Apply proper canvas scaling</li>
            </ul>
            
            <div class="demo-box">
                <p><strong>Next Session:</strong> Game Object Structure & State Management</p>
                <p><strong>Homework:</strong> Expand your utility module with 5 more helper functions</p>
            </div>
            
            <div class="tip-box">
                <strong>Challenge:</strong> Try implementing a "zoom" feature that maintains quality!
            </div>
        </div>

        <!-- Navigation Controls -->
        <div class="navigation">
            <button id="prevBtn">Previous</button>
            <span class="slide-counter">
                <span id="currentSlide">1</span> / <span id="totalSlides">15</span>
            </span>
            <button id="nextBtn">Next</button>
        </div>
    </div>

    <!-- Shared Presentation JavaScript -->
    <script src="../../js/presentation.js"></script>

    <!-- Lecture-Specific JavaScript -->
    <script>
        // Display device pixel ratio on slide 3
        document.addEventListener('DOMContentLoaded', function() {
            var pixelRatioDisplay = document.getElementById('pixelRatio');
            if (pixelRatioDisplay) {
                pixelRatioDisplay.textContent = (window.devicePixelRatio || 1).toFixed(2);
            }
            
            // Draw on demo canvases when on slide 3
            document.addEventListener('slidechange', function(e) {
                if (e.detail.currentSlide === 2) { // Slide 3 (0-indexed)
                    drawComparisonCanvases();
                }
                
                // Start exercise timer for exercise slides
                if (e.detail.currentSlide >= 9 && e.detail.currentSlide <= 11) {
                    startExerciseTimer(e.detail.currentSlide === 9 ? 10 : 15);
                } else {
                    stopExerciseTimer();
                }
            });
        });
        
        function drawComparisonCanvases() {
            var canvases = document.querySelectorAll('.canvas-demo');
            canvases.forEach(function(canvas, index) {
                var ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw content
                ctx.fillStyle = '#333';
                ctx.font = '14px Arial';
                ctx.fillText('Sharp?', 20, 30);
                
                // Draw a circle
                ctx.beginPath();
                ctx.arc(50, 60, 20, 0, Math.PI * 2);
                ctx.strokeStyle = '#0066cc';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // Draw a thin line
                ctx.beginPath();
                ctx.moveTo(10, 90);
                ctx.lineTo(90, 90);
                ctx.stroke();
                
                // If it's the second canvas, simulate blur
                if (index === 1) {
                    ctx.filter = 'blur(0.5px)';
                    // Redraw with blur
                    ctx.fillText('Sharp?', 20, 30);
                    ctx.beginPath();
                    ctx.arc(50, 60, 20, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });
        }
        
        // Exercise timer functionality
        var exerciseTimer;
        var exerciseTimerDisplay = document.getElementById('exercise-timer');
        var exerciseTimeText = document.getElementById('exercise-time');
        
        function startExerciseTimer(minutes) {
            stopExerciseTimer(); // Clear any existing timer
            
            var totalSeconds = minutes * 60;
            exerciseTimerDisplay.style.display = 'block';
            
            exerciseTimer = setInterval(function() {
                var mins = Math.floor(totalSeconds / 60);
                var secs = totalSeconds % 60;
                exerciseTimeText.textContent = 
                    (mins < 10 ? '0' : '') + mins + ':' + 
                    (secs < 10 ? '0' : '') + secs;
                
                if (totalSeconds <= 0) {
                    stopExerciseTimer();
                    alert('Time\'s up! Let\'s review the solution.');
                }
                totalSeconds--;
            }, 1000);
        }
        
        function stopExerciseTimer() {
            if (exerciseTimer) {
                clearInterval(exerciseTimer);
                exerciseTimerDisplay.style.display = 'none';
            }
        }
        
        // Example utility module for demonstration
        var gameUtils = {
            randomColor: function() {
                return '#' + Math.floor(Math.random()*16777215).toString(16);
            },
            randomPosition: function(maxX, maxY) {
                return {
                    x: Math.floor(Math.random() * maxX),
                    y: Math.floor(Math.random() * maxY)
                };
            },
            drawCircle: function(ctx, x, y, radius, color) {
                ctx.fillStyle = color || '#000';
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
            }
        };
    </script>
</body>
</html>