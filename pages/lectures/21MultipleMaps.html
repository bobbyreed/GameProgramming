<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 20: Multiple Maps & Scene Switching - CSCI 3213</title>
    
    <!-- OCU Branded Presentation Styles with Theme Support -->
    <link rel="stylesheet" href="../../styles/presentation.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    
    <!-- Lecture-Specific Styles -->
    <style>
        .scene-demo {
            background: #1a1a2e;
            color: #0f0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            border: 2px solid #16213e;
        }
        
        .map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .map-card {
            background: var(--card-bg, #f8f8f8);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border-color, #ddd);
        }
        
        .code-showcase {
            background: #2d2d2d;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #00ff00;
        }

        .signal-flow {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--ocu-cyan);
        }

        .implementation-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .resource-link {
            color: #00a8ff;
            text-decoration: none;
            font-weight: bold;
        }
        
        .resource-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="presentation-container">
        <div class="timer-display" id="timer-display">
            <span id="timer-text">Lecture 20: Multiple Maps & Scene Switching
                 <button class="home"><a href="../../index.html">Home</a></button>
            </span>
        </div>

        <!-- Slide 1: Title -->
        <div class="slide active">
            <h1>Multiple Maps & Scene Switching</h1>
            <h2>Level Up Your Game <span class="emoji">🗺️</span></h2>
            <p style="font-size: 1.5em; margin-top: 40px;">CSCI 3213 - Game Programming</p>
            <p style="font-size: 1.3em;">Spring '26 - Week 20, Lecture 1</p>
            <p style="margin-top: auto; font-style: italic;">Build games with multiple levels and smooth transitions!</p>
        </div>

        <!-- Slide 2: Learning Objectives -->
        <div class="slide">
            <h1>Today's Quest Objectives</h1>
            <ul style="font-size: 1.4em; line-height: 2;">
                <li>🎯 Understand custom signals in Godot</li>
                <li>🎯 Implement map completion detection</li>
                <li>🎯 Create multiple game levels</li>
                <li>🎯 Build automatic scene switching systems</li>
                <li>🎯 Handle deferred function calls for safety</li>
            </ul>
        </div>

        <!-- Slide 3: Review - Where We Left Off -->
        <div class="slide">
            <h1>Quick Review: Detectors</h1>
            <div class="signal-flow">
                <h3>Last Time We Built:</h3>
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li>✅ Pressure plate detectors</li>
                    <li>✅ Object counting on detectors</li>
                    <li>✅ Visual feedback (color changes)</li>
                    <li>✅ Pulsing animations for invalid states</li>
                </ul>
                <p style="margin-top: 20px;"><strong>Today:</strong> We use these detectors to trigger map completion!</p>
            </div>
        </div>

        <!-- Slide 4: Custom Signals -->
        <div class="slide">
            <h1>Custom Signals in Godot</h1>
            <div class="implementation-box">
                <h3>What Are Signals?</h3>
                <p style="font-size: 1.2em; margin: 15px 0;">Signals are Godot's event system - a way for nodes to communicate without tight coupling</p>
                
                <div class="code-showcase" style="font-size: 0.9em;">
<pre>extends Area2D

# Define a custom signal
signal validity_changed(valid: bool)

# Emit the signal when state changes
func _on_body_entered(_body: Node2D) -> void:
    if object_count == 0:
        sprite.modulate = valid_color
        validity_changed.emit(true)  # 🔔 Signal!
    object_count += 1</pre>
                </div>
            </div>
        </div>

        <!-- Slide 5: Why Custom Signals? -->
        <div class="slide">
            <h1>Why Custom Signals?</h1>
            <div class="map-grid">
                <div class="map-card">
                    <h3>🔓 Decoupling</h3>
                    <p>Detectors don't need to know about the map or game logic</p>
                </div>
                <div class="map-card">
                    <h3>🔄 Reusability</h3>
                    <p>Same detector can be used in different contexts</p>
                </div>
                <div class="map-card">
                    <h3>🎯 Clear Intent</h3>
                    <p>Signal names describe what happened</p>
                </div>
                <div class="map-card">
                    <h3>⚡ Flexibility</h3>
                    <p>Multiple listeners can respond to one signal</p>
                </div>
            </div>
        </div>

        <!-- Slide 6: Tracking Map Completion -->
        <div class="slide">
            <h1>Detecting Map Completion</h1>
            <div class="implementation-box">
                <h3>The Strategy:</h3>
                <ol style="font-size: 1.2em; line-height: 1.8; text-align: left; display: inline-block;">
                    <li>Count total detectors in the map</li>
                    <li>Count how many are currently valid</li>
                    <li>When valid count equals total count → Map Complete!</li>
                </ol>
                
                <div class="code-showcase" style="font-size: 0.85em; margin-top: 20px;">
<pre>extends Node

var registered_detector_count := 0
var valid_detector_count := 0

func _on_detector_validity_changed(valid: bool) -> void:
    if valid:
        valid_detector_count += 1
        if valid_detector_count == registered_detector_count:
            load_next_map.call_deferred()
    else:
        valid_detector_count -= 1</pre>
                </div>
            </div>
        </div>

        <!-- Slide 7: Connecting Signals Programmatically -->
        <div class="slide">
            <h1>Dynamic Signal Connection</h1>
            <div class="signal-flow">
                <h3>Why Connect Via Code?</h3>
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li>⚡ Automatic - no manual work in editor</li>
                    <li>🛡️ Less error-prone than manual connections</li>
                    <li>📈 Scales easily to many detectors</li>
                </ul>
                
                <div class="code-showcase" style="font-size: 0.85em; margin-top: 15px;">
<pre>func _ready() -> void:
    for child_node in get_children():
        var detector := child_node as Detector
        if detector:
            registered_detector_count += 1
            detector.validity_changed.connect(
                _on_detector_validity_changed
            )</pre>
                </div>
            </div>
        </div>

        <!-- Slide 8: Class Names in GDScript -->
        <div class="slide">
            <h1>Using Class Names</h1>
            <div class="implementation-box">
                <h3>Making Scripts Referenceable</h3>
                <p style="font-size: 1.2em;">Add <code style="background: #2d2d2d; color: #00ff00; padding: 3px 8px; border-radius: 4px;">class_name Detector</code> to the detector script</p>
                
                <div class="map-grid" style="margin-top: 30px;">
                    <div class="map-card">
                        <h3>✅ With class_name</h3>
                        <code style="display: block; margin: 10px 0;">var det := node as Detector</code>
                        <p>Type-safe casting</p>
                    </div>
                    <div class="map-card">
                        <h3>❌ Without class_name</h3>
                        <code style="display: block; margin: 10px 0;">if "detector" in node.name</code>
                        <p>Fragile string checking</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 9: Creating Multiple Maps -->
        <div class="slide">
            <h1>Building Your Map Collection</h1>
            <div class="implementation-box">
                <h3>Map Naming Convention</h3>
                <p style="font-size: 1.3em; margin: 20px 0;">Format: <code style="background: #2d2d2d; color: #00ff00; padding: 5px 10px; border-radius: 4px;">map.###.tscn</code></p>
                
                <div class="scene-demo" style="font-size: 1.1em;">
maps/
├── map.001.tscn  ← First level (easy)
├── map.002.tscn  ← Second level
├── map.003.tscn  ← Third level
└── ...
                </div>
                
                <p style="margin-top: 20px; font-size: 1.1em;"><strong>Pro Tip:</strong> Use leading zeros for proper file sorting!</p>
            </div>
        </div>

        <!-- Slide 10: Automatic Next Map Loading -->
        <div class="slide">
            <h1>Smart Map Progression</h1>
            <div class="signal-flow">
                <h3>The Algorithm:</h3>
                <ol style="font-size: 1.2em; line-height: 1.8; text-align: left; display: inline-block;">
                    <li>Get current map's file path</li>
                    <li>Split the path by periods: <code>["res://maps/map", "001", "tscn"]</code></li>
                    <li>Extract and increment the number</li>
                    <li>Pad with zeros: <code>str(2).pad_zeros(3)</code> → <code>"002"</code></li>
                    <li>Join back together</li>
                    <li>Load the next scene!</li>
                </ol>
            </div>
        </div>

        <!-- Slide 11: Code Walkthrough - Part 1 -->
        <div class="slide">
            <h1>Loading Next Map: Step by Step</h1>
            <div class="code-showcase" style="font-size: 0.75em;">
<pre>func load_next_map() -> void:
    # Step 1: Get current map path
    var current_map_path := get_tree().current_scene.scene_file_path
    # Result: "res://maps/map.001.tscn"
    
    # Step 2: Split on periods
    var split_path := current_map_path.split(".")
    # Result: ["res://maps/map", "001", "tscn"]
    
    # Step 3: Extract number, add 1
    var next_map_number := split_path[1].to_int() + 1
    # Result: 2</pre>
            </div>
        </div>

        <!-- Slide 12: Code Walkthrough - Part 2 -->
        <div class="slide">
            <h1>Loading Next Map: Completion</h1>
            <div class="code-showcase" style="font-size: 0.75em;">
<pre>    # Step 4: Format with leading zeros
    split_path[1] = str(next_map_number).pad_zeros(3)
    # Result: "002"
    
    # Step 5: Rejoin the path
    var next_map_path = ".".join(split_path)
    # Result: "res://maps/map.002.tscn"
    
    # Step 6: Load the scene!
    get_tree().change_scene_to_file(next_map_path)</pre>
            </div>
            <p style="margin-top: 20px; font-size: 1.1em;">✨ Convention-based magic - no hardcoded sequences!</p>
        </div>

        <!-- Slide 13: Deferred Calls -->
        <div class="slide">
            <h1>The Deferred Call Pattern</h1>
            <div class="implementation-box">
                <h3>⚠️ Problem:</h3>
                <p style="font-size: 1.2em; margin: 15px 0;">Changing scenes during a physics callback causes errors</p>
                
                <h3 style="margin-top: 30px;">✅ Solution: Deferred Calls</h3>
                <div class="code-showcase" style="font-size: 0.9em; margin-top: 15px;">
<pre># ❌ Immediate call (dangerous during physics)
load_next_map()

# ✅ Deferred call (safe)
load_next_map.call_deferred()</pre>
                </div>
                <p style="margin-top: 20px; font-size: 1.1em;"><code>call_deferred()</code> delays execution until after the current frame's processing is complete</p>
            </div>
        </div>

        <!-- Slide 14: Looping Back to First Map -->
        <div class="slide">
            <h1>Handling Non-Existent Maps</h1>
            <div class="signal-flow">
                <h3>Check if the Next Map Exists</h3>
                <div class="code-showcase" style="font-size: 0.85em; margin-top: 15px;">
<pre>var next_map_path = ".".join(split_path)

# If map doesn't exist, loop back to map 001
if not ResourceLoader.exists(next_map_path):
    split_path[1] = "001"
    next_map_path = ".".join(split_path)
    
get_tree().change_scene_to_file(next_map_path)</pre>
                </div>
                <p style="margin-top: 20px; font-size: 1.2em;">🔄 Creates an infinite game loop through your levels!</p>
            </div>
        </div>

        <!-- Slide 15: Activity - Build Your Map System -->
        <div class="slide">
            <h1>Hands-On Activity</h1>
            <div class="implementation-box">
                <h2>🎮 Build Multiple Maps (20 minutes)</h2>
                <ol style="font-size: 1.2em; line-height: 1.8; text-align: left; display: inline-block; margin-top: 20px;">
                    <li>Add the custom signal to your detector script</li>
                    <li>Create the map.gd script with completion tracking</li>
                    <li>Create at least 3 different maps (map.001, map.002, map.003)</li>
                    <li>Make map.001 very simple to complete quickly</li>
                    <li>Implement the automatic map loading system</li>
                    <li>Test completing all maps and looping back!</li>
                </ol>
            </div>
            <button data-timer="20" style="margin-top: 20px;">Start 20-Minute Timer</button>
        </div>

        <!-- Slide 16: Best Practices -->
        <div class="slide">
            <h1>Map Design Best Practices</h1>
            <div class="map-grid">
                <div class="map-card">
                    <h3>📈 Progressive Difficulty</h3>
                    <p>Start easy, gradually increase challenge</p>
                </div>
                <div class="map-card">
                    <h3>🎯 Clear Objectives</h3>
                    <p>Players should understand what to do</p>
                </div>
                <div class="map-card">
                    <h3>⚡ Quick Testing</h3>
                    <p>Make map.001 fast to test systems</p>
                </div>
                <div class="map-card">
                    <h3>🗂️ Organized Files</h3>
                    <p>Keep maps in a dedicated folder</p>
                </div>
            </div>
        </div>

        <!-- Slide 17: Advanced Concepts -->
        <div class="slide">
            <h1>Going Further</h1>
            <div class="signal-flow">
                <h3>Extensions You Could Add:</h3>
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li>🏆 Map completion time tracking</li>
                    <li>⭐ Star ratings based on performance</li>
                    <li>🎨 Smooth fade transitions between maps</li>
                    <li>💾 Save/load system for map progress</li>
                    <li>🎵 Different music for each map</li>
                    <li>🔓 Unlockable maps based on completion</li>
                </ul>
            </div>
        </div>

        <!-- Slide 18: Common Pitfalls -->
        <div class="slide">
            <h1>Watch Out For These Issues</h1>
            <div class="implementation-box">
                <div class="map-grid">
                    <div class="map-card" style="border-left: 4px solid #ff4444;">
                        <h3>❌ Don't</h3>
                        <ul style="text-align: left;">
                            <li>Call scene changes during physics</li>
                            <li>Hardcode map sequences</li>
                            <li>Forget to set class_name</li>
                            <li>Skip error checking</li>
                        </ul>
                    </div>
                    <div class="map-card" style="border-left: 4px solid #44ff44;">
                        <h3>✅ Do</h3>
                        <ul style="text-align: left;">
                            <li>Use call_deferred()</li>
                            <li>Use naming conventions</li>
                            <li>Check resource existence</li>
                            <li>Test map loops</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 19: Homework -->
        <div class="slide">
            <h1>Homework Assignment</h1>
            <h2>Continue Your Game Project</h2>
            <div class="demo-box">
                <p><strong>For the Rest of the Semester:</strong></p>
                <ul style="text-align: left; display: inline-block; font-size: 1.2em;">
                    <li>📝 Continue developing your semester game project</li>
                    <li>🗺️ Implement multiple levels/maps in your game</li>
                    <li>🎮 Add progression and completion detection</li>
                    <li>🎨 Polish existing features</li>
                    <li>🔧 Fix any outstanding bugs</li>
                    <li>📸 Document your progress</li>
                </ul>
                <p style="margin-top: 30px; font-size: 1.3em;"><strong>⏰ Remember:</strong> Your game project is due at the end of the semester!</p>
            </div>
        </div>

        <!-- Slide 20: Resources -->
        <div class="slide">
            <h1>Additional Resources</h1>
            <div class="implementation-box">
                <h3>📚 Learn More:</h3>
                <ul style="font-size: 1.2em; line-height: 1.8; text-align: left; display: inline-block;">
                    <li>🔗 <a href="https://docs.godotengine.org/en/stable/getting_started/step_by_step/signals.html" class="resource-link" target="_blank">Godot Signals Documentation</a></li>
                    <li>🔗 <a href="https://docs.godotengine.org/en/stable/classes/class_resourceloader.html" class="resource-link" target="_blank">ResourceLoader API</a></li>
                    <li>🔗 See the course repository readme for source material references</li>
                </ul>
                
                <p style="margin-top: 40px; font-size: 1.1em;"><strong>Original Tutorial:</strong> Based on "Multiple Maps" tutorial from Godot 4.3 series</p>
            </div>
        </div>

        <!-- Slide 21: Key Takeaways -->
        <div class="slide">
            <h1>Key Takeaways</h1>
            <div class="demo-box">
                <ul style="font-size: 1.3em; line-height: 2; text-align: left; display: inline-block;">
                    <li>✅ Custom signals enable loose coupling</li>
                    <li>✅ Track completion with simple counters</li>
                    <li>✅ Naming conventions enable automatic progression</li>
                    <li>✅ Always use call_deferred() for scene changes</li>
                    <li>✅ Check resource existence before loading</li>
                    <li>✅ String manipulation is powerful for dynamic loading</li>
                </ul>
            </div>
        </div>

        <!-- Slide 22: Next Steps -->
        <div class="slide">
            <h1>Coming Up Next</h1>
            <h2>Future Topics</h2>
            <div class="map-grid">
                <div class="map-card">
                    <h3>🎬 Map Transitions</h3>
                    <p>Smooth fades and effects</p>
                </div>
                <div class="map-card">
                    <h3>💾 Save Systems</h3>
                    <p>Persist player progress</p>
                </div>
                <div class="map-card">
                    <h3>🏆 Statistics</h3>
                    <p>Track game metrics</p>
                </div>
                <div class="map-card">
                    <h3>🎮 Final Polish</h3>
                    <p>Complete your game!</p>
                </div>
            </div>
            <p style="margin-top: 40px; font-size: 1.2em;">Keep building amazing games!</p>
        </div>

        <!-- Slide 23: Summary -->
        <div class="slide">
            <h1>Session Complete! <span class="emoji">🏆</span></h1>
            <h2>Skills Unlocked:</h2>
            <ul style="font-size: 1.3em; line-height: 2;">
                <li>✅ Created custom signals for communication</li>
                <li>✅ Implemented map completion detection</li>
                <li>✅ Built multiple game levels</li>
                <li>✅ Automated scene switching</li>
                <li>✅ Used deferred calls for safety</li>
                <li>✅ Handled edge cases with resource checking</li>
            </ul>
            
            <div class="demo-box" style="margin-top: 40px;">
                <p><strong>Great Work!</strong> You now have all the tools to create multi-level games!</p>
                <p><strong>Keep Working:</strong> Your semester project is due soon - make it amazing!</p>
            </div>
        </div>

        <!-- Navigation Controls -->
        <div class="navigation">
            <button id="prevBtn">Previous</button>
            <span class="slide-counter">
                <span id="currentSlide">1</span> / <span id="totalSlides">23</span>
            </span>
            <button id="nextBtn">Next</button>
        </div>
    </div>

    <!-- Shared Presentation JavaScript -->
    <script src="../../js/presentation.js"></script>

    <script>
        // Listen for slide changes
        document.addEventListener('slidechange', (e) => {
            console.log(`Slide ${e.detail.currentSlide + 1} of ${e.detail.totalSlides}`);
            
            // Could add specific demos or animations for certain slides
            if (e.detail.currentSlide === 14) {
                console.log('Ready for hands-on activity!');
            }
        });
    </script>
</body>
</html>